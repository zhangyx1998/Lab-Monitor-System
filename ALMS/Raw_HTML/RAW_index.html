<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<!--<meta http-equiv="refresh" content="60">-->
		<title>Env Monitor</title> 
		<style>
			body
			{
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			input::-webkit-outer-spin-button,  
			input::-webkit-inner-spin-button{  
				-webkit-appearance: none !important;  
				margin: 0;  
			} 

			.Float_TG
			{
				position: fixed;
				bottom: 10px;
				right: 10px;
		        height: 24px;
		        width: 200px;  
		        color: #FFFFFF;
		        background: rgba(0,0,0,0.6);：
		        border-width: 10px 5px 10px 5px;  
		        border-style: solid;
		        border-radius: 10px; 
		        border-color: rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);
				overflow: ellipsis;
		    }  
			      
		    .Float_TG p
		    {  
		        margin: 0px auto;  
		        padding: 0px;  
		        text-align: center;  
		        vertical-align: middle;
		        font-size: 12px;
		        line-height: 22px;
		        letter-spacing:0px;  
		    }  

			.uni_table{
				border-style: none;
			}
			.text_box{
				text-align: center;
				color: #fff;
				border: none;
				text-align: center; 
				overflow: hidden;
				background-color: #FFFFFF;
				color: #000000
			}
			.text_box:focus{
				font-style: italic;
				outline: none;
			 }

			.text_box.L{
				font-weight: bold;
				font-size: 12px;
			}
			.text_box.M{
				font-weight: normal;
				font-size: 12px;
			}
			.text_box.S{
				font-weight: thin;
				font-size: 6px;
			}

			.button{
				line-height: 12px;
				text-align: center;
				font-weight: bold;
				color: #fff;
				border-radius: 5px;
				margin: 0px 0px 0px 0px;
				position: relative;
				align-self: center;
				overflow: hidden;
				z-index: 0;
			}
			.button:focus{
				outline: none;
			 }

			.button:nth-child(6n){
				margin-right: 0;
			}
			.button.gray{
				color: #8c96a0;
				text-shadow:1px 1px 1px #fff;
				border:1px solid #dce1e6;
				box-shadow: 0 1px 2px #fff inset,0 -1px 0 #a8abae inset;
				background: -webkit-linear-gradient(top,#f2f3f7,#e4e8ec);
				background: -moz-linear-gradient(top,#f2f3f7,#e4e8ec);
				background: linear-gradient(top,#f2f3f7,#e4e8ec);
			}
			.gray:hover{
				background: -webkit-linear-gradient(top,#fefefe,#ebeced);
				background: -moz-linear-gradient(top,#f2f3f7,#ebeced);
				background: linear-gradient(top,#f2f3f7,#ebeced);
			}
			.button.gray:focus{
					 background-color: #00ff00;
			}

			.MTR_button{
				line-height: 12px;
				text-align: center;
				font-weight: bold;
				outline: none;
				color: #fff;
				margin: 0px 0px 0px 0px;
				position: relative;
				align-self: center;
				overflow: hidden;
				z-index: 0;
			}
			.MTR_button:nth-child(6n){
				margin-right: 0;
			}
			.MTR_button.uni{
				color: #FFFFFF;
				border: none;
				background-color: rgba(0,0,0,0);
			}
			.uni:hover{
				background-color: rgba(255,255,255,0.5);
			}

			.uni:active{
				background-color: rgba(0,0,0,0.5);
			}

			.uni:focus{
      			outline: none;
				background-color: rgba(0,0,0,0);
			}
		</style>
	</head>

	<body>
		<div style="margin: 0 auto; width:100%; position: fixed; top: 0px; left: 0px; text-align: center;height: 60px; background-color: rgb(10,100,170); color: #FFFFFF; z-index:1;">
			<font face="Avenir">
				<table width="100%" border="0" align="center" rules=none cellspacing=0 cellpadding=0>
					<tr>
						<td colspan="1" align="right" valign="center" width="8%">
						</td>
						<td colspan="1" align="left" valign="center" width="54%" height="60px" style="overflow: hidden;">
							<font size="5%" >ATLAS Lab Environment Monitor System</font>
						</td>
						<td colspan="1" align="right" valign="center" height="60px" style="line-height:20px;overflow: hidden;">
							<font style="color: #DDDDDD" size="2%">
								General Status: #*General_Status*#<br>
								LBL pixelKr project team at Bekeley
							</font>
						</td>
						<td colspan="1" align="right" valign="center" width="8%">
						</td>
					</tr>
				</table>
			</font>
		</div>

		<div class="Float_TG" id="Flaot_TG" onclick="(function(){/*getElementById('Flaot_TG').style.display='none';*/location.reload(true);})()" style="z-index: 4">  
    		<p><font face="Avenir" style="vertical-align: middle;">Last Update #*CURRENT_TIMESTAMP*#</font></p>
		</div>  

		<div style="position: relative; height: 100px; display: block;" align="center">
		</div>

		<table id="TH_Table" width="85%" border="0" align="center" rules=none cellspacing=0 >
			<tr style="height:40px;background-color:#00AA88;">
				<td colspan="1" style="font-size: 14px;" align="left" width="30%">
					<font color="#FFFFFF" face="Avenir" size="3" style="font-weight: bold;">&nbsp;&nbsp;TEMPERATURE</font>
				</td>
				<td colspan="2" align="center" color="#666666"  width="40%">
					<button onClick="MOVE_LEFT(24);"  type="MTR_button" class="MTR_button uni" align="center" style="width: 40px; height: 40px;">
						<font face="Avenir" size="3" style="font-weight:normal; line-height: 36px"><<</font>
					</button>
					<button onClick="MOVE_LEFT(6);" type="MTR_button" class="MTR_button uni" align="center" style="width: 40px; height: 40px;">
						<font face="Avenir" size="3" style="font-weight:normal; line-height: 36px"><</font>
					</button>
					<button onClick="RESET_ALL();" oncontextmenu="DBG_Switch();" type="MTR_button" class="MTR_button uni" align="center" style="width: 80px; height: 40px;">
						<font face="Avenir" size="3" style="font-weight:normal; line-height: 36px">RESET</font>
					</button>
					<button onClick="MOVE_RIGHT(6);" type="MTR_button" class="MTR_button uni" align="center" style="width: 40px; height: 40px;">
						<font face="Avenir" size="3" style="font-weight:normal; line-height: 36px">></font>
					</button>
					<button onClick="MOVE_RIGHT(24);" type="MTR_button" class="MTR_button uni" align="center" style="width: 40px; height: 40px;">
						<font face="Avenir" size="3" style="font-weight:normal; line-height: 36px">>></font>
					</button>
				</td>
				<td colspan="1" style="font-size: 14px"  align="right"  width="30%">
					<font color="#FFFFFF" face="Avenir" size="3" style="font-weight: bold;">HUMIDITY&nbsp;&nbsp;</font>
				</td>
			</tr>

				<tr style="height: 1px">
					<td colspan="4" style="background-color:#FFFFFF;text-align:center;">
				</tr>
		</table>

		<center>
			<canvas id="TH_Chart" style="width:85%;">
			</canvas>
		</center>


		<div style="position: relative; height: 5px; display: block;" align="center">
		</div>

		<table width="85%" border="0" align="center" style="border-style: none; table-layout:fixed" rules=none cellspacing=0>
			<col style="width: 4% " />
			<col style="width: 0.4% " />
			<col style="width: 12% " />
			<col style="width: 12% " />
			<col />
			<col style="width: 18% " />
			<tbody>

				<tr style="height:60px">
					<td style="background-color: rgba(255,255,255,0);color: #000;text-align: left;" colspan="6">
						<font face="Avenir" size="5" style="font-weight: normal;">System Log</font>
					</td>
				</tr>	

				<tr style="height:40px">
					<td style="background-color: #EE6600;color: #FFF;text-align: center;">
						<font face="Avenir" size="3">ID</font>
					</td>
					<td style="background-color: #EE6600;color: #FFF;text-align: center;">
					</td>
					<td style="background-color: #EE6600;color: #FFF;text-align: center;">
						<font face="Avenir" size="3">SOURCE</font>
					</td>
					<td style="background-color: #EE6600;color: #FFF;text-align: center;">
						<font face="Avenir" size="3">TYPE</font>
					</td>
					<td style="background-color: #EE6600;color: #FFF;text-align: center;">
						<font face="Avenir" size="3">CONTENT</font>
					</td>
					<td style="background-color: #EE6600;color: #FFF;text-align: center;">
						<font face="Avenir" size="3">DATE</font>
					</td>
				</tr>

				<tr style="height: 8px">
					<td colspan="6" style="background-color:#FFFFFF;text-align:center;">
				</tr>

				<tr style="height: 6px">#*!LineMerge$1*#
					<td style="line-height:28px;background-color:#AAAAAA;">
					</td>
					<td style="line-height:28px;background-color:#00AA88;">
					</td>
					<td style="line-height:28px;background-color:#DDDDDD;">
					</td>
					<td style="line-height:28px;background-color:#EEEEEE;">
					</td>
					<td style="line-height:28px;background-color:#FFDDAA;">
					</td>
					<td style="line-height:28px;background-color:#DDDDDD;">
					</td>
				</tr>
				<tr>
						<td style="line-height:28px;background-color:#AAAAAA;text-align: center; color: #fff;">
							<font face="Avenir" size="3">#*!intv$1*##*<table$Log>ID$00000000*#</font>
						</td>
						<td style="line-height:28px;background-color:#00AA88;text-align: center; color: #fff;">
						</td>
						<td style="line-height:28px;background-color:#DDDDDD;text-align: center; color: #000;">
							<font face="Avenir" size="3">#*!intv$1*##*<table$Log>MSG_Source$00000000*#</font>
						</td>
						<td style="line-height:28px;background-color:#EEEEEE;text-align: center; color: #000;">
							<font face="Avenir" size="3">#*!intv$1*##*<table$Log>MSG_Type$00000000*#</font>
						</td>
						<td style="line-height:28px;background-color:#FFDDAA;text-align: center; color: #000;">
							<font face="Avenir" size="3">#*!intv$1*##*<table$Log>MSG_Index$00000000*#</font>
						</td>
						<td style="line-height:28px;background-color:#DDDDDD;text-align: center; color: #000000;">
							<font face="Avenir" size="3">#*!intv$1*##*<table$Log>Date_Time$00000000*#</font>
						</td>
				</tr>
				<tr style="height: 6px">
					<td style="line-height:28px;background-color:#AAAAAA;">
					</td>
					<td style="line-height:28px;background-color:#00AA88;">
					</td>
					<td style="line-height:28px;background-color:#DDDDDD;">
					</td>
					<td style="line-height:28px;background-color:#EEEEEE;">
					</td>
					<td style="line-height:28px;background-color:#FFDDAA;">
					</td>
					<td style="line-height:28px;background-color:#DDDDDD;">
					</td>
				</tr>
				<tr style="height: 8px">
					<td colspan="6" style="background-color:#FFFFFF;text-align:center;">
				</tr>#*!LineMerge$0*#
				<tr style="height: 3px">
					<td colspan="6" style="background-color:#FF6600;text-align:center;">
				</tr>		 
				<tr style="height: 10px">
					<td colspan="6" style="background-color:#FFFFFF;text-align:center;">
				</tr>	
				<tr style="height: 30px">
					<td colspan="6" style="background-color:#FFFFFF;text-align:center;">
						<a href="Version-Gallery.html" style="color: #666666;">
							<font face="Avenir" size="3">Click HERE For Verison Gallery</font>
						</a>
				</tr>
			</tbody>
		</table>


		<div style="margin: 0 auto; width:85%; position: relative; border:none; text-align: center;height: 80px; background-color: #FFFFFF; color: #666; z-index:1; padding: 0px; vertical-align: middle;">
			<font face="Avenir">
				<div style="margin: 0 auto; width: 100% ; height: 100% ; position: absolute; left: 0px; top: 0px; z-index: 2; text-align: center; vertical-align: middle;">
					<font style="line-height: 16px; font-weight: normal; vertical-align: middle;" align="center" size="3"><br>By Yuxuan Zhang
					</font>
					<font style="line-height: 16px; font-weight: bold; vertical-align: middle;" align="center" size="1"><br>APRIL 2018</font>
				</div>
				<div style="margin: 0 auto; width: 100% ; height: 100% ; position: absolute; left: 0px; top: 0px; z-index: 3">
					<a href="https://yuxuanzhang.myportfolio.com" style="display:block; width:100%; height:100%;"></a>
				</div>
			</font>
		</div>

		<!--######################################################################################-->
		<script type="text/javascript">	
			//DATA
			TEMP_Buf=new Array(
				#*!intv$60*##*ET_D$00000000*#,
				"END"
				);
			HUMIDITY_Buf=new Array(
				#*!intv$60*##*EH_D$00000000*#,
				"END"
				);
			DATETIME_Buf=new Array(
				#*!intv$60*##*DT_Str$00000000*#,
				"END"
				);
			//var timer = setInterval(refresh(evt),100);
			//ARROWS ▶ ◀ ▲ ▼
			var Debug=false;
			//Preset
			var Device=0;//0: Desktop; 1:Mobile; 2:Mobile_Horizational_Orentation 3:Tablet

			//PRE_DEFINED VALUES
			var chart=document.getElementById("TH_Chart");
			var ctx=chart.getContext("2d");
				ctx.save();
			var devicePixelRatio = window.devicePixelRatio || 1;
			var backingStoreRatio = ctx.webkitBackingStorePixelRatio ||
								ctx.mozBackingStorePixelRatio ||
								ctx.msBackingStorePixelRatio ||
								ctx.oBackingStorePixelRatio ||
								ctx.backingStorePixelRatio || 1;
			var ratio = devicePixelRatio / backingStoreRatio;
			var Default_L_limit_max=[26279,26279,26279];
			var Default_R_limit_min=[0,0,0];
			var Default_Pedding_len=[14*ratio,14*ratio,14*ratio];
			var Default_marker_WIDTH=[40*ratio,60*ratio,40*ratio];
			var Default_Scale_Index=[1,2,1.5,1];
			var Default_max_T=[28,28,28,28];
			var Default_min_T=[18,18,18,18];
			var Default_max_H=[65,65,65,65];
			var Default_min_H=[35,30,30,35];
			var Default_L_limit=[120,60,120,120];
			var Default_R_limit=[0,0,0,0];
			var Default_H_Lines=[5,4,4,5];
			var Default_V_Lines=[20,8,10,20];
			var Default_Mark_line_len=[5*ratio,5*ratio,5*ratio,5*ratio];
			var Default_Mark_line_wid=[2*ratio,2*ratio,2*ratio,2*ratio];
			var Default_side_spacing =[5*ratio,5*ratio,5*ratio,5*ratio];
			var Default_golbal_line_width =[0.8*ratio,0.8*ratio,0.8*ratio,0.5*ratio];
			//Appearence Preset

			//Will Be changed later:
			var L_limit_max=26279;
			var R_limit_min=0;
			var Pedding_len=0;
			var marker_WIDTH=0;
			var Scale_Index=0;
			var max_T=0;
			var min_T=0;
			var max_H=0;
			var min_H=0;
			var L_limit=0;
			var R_limit=0;
			var H_Lines=0;
			var V_Lines=0;
			var Mark_line_len=0;
			var Mark_line_wid=0;
			var side_spacing =0;
			var golbal_line_width=0;

			var chart_ratio=0;
			var Grid_length=0;
			var Mouse_Position_Flag=0;
			var Mouse_Down_Flag=0; //0:None 1:Center_Area 2:Left_Marker 3:Rlght_Marker 4:Bottom_Marker 5:Bottom Axis Line
			var HEIGHT=0
			var HEIGHT_Chart=0;
			var HEIGHT_Container=0;
			var WIDTH=0;

			//VARIABLES
			var x=0;
			var y=0;
			var org_x=0;
			var org_y=0;
			var org_L=0;
			var org_R=0;
			var org_max_T=0;
			var org_min_T=0;
			var org_max_H=0;
			var org_min_H=0;

			//Style Preset
			TEMP_Color="#FF6600"
			TEMP_BKG_Color="#FFDDAA"
			TEMP_OnGrag_Color="#FFBB66"
			HUMIDITY_Color="#00AAFF"
			HUMIDITY_BKG_Color="#DDEEFF"
			HUMIDITY_OnGrag_Color="#BBDDFF"
			On_Outside_Drag_Clolr="#CCCCCC"

			var vaild_n=0

			window.onresize= RESET ;

			if (navigator.userAgent.indexOf("iPhone")>0)
			{
				try
				{
					window.addEventListener("orientationchange", RESET , false)
				}
				catch(err)
				{
					;
				}
			}

			document.oncontextmenu=function (){return false;}

			chart.onmousedown = function (evt) 
			{
				x = (evt.pageX-chart.offsetLeft)*ratio;
				y = (evt.pageY-chart.offsetTop)*ratio;
				org_x = x;
				org_y = y;
				org_L = L_limit;
				org_R = R_limit;
				org_max_T = max_T;
				org_min_T = min_T;
				org_max_H = max_H;
				org_min_H = min_H;

				Mouse_Down_Flag=get_area_id(org_x,org_y);		

				refresh();
			}

			chart.onmouseup = function (evt) 
			{
				x = (evt.pageX-chart.offsetLeft)*ratio;
				y = (evt.pageY-chart.offsetTop)*ratio;
				Mouse_Down_Flag=0;
				refresh();
			}
			
			chart.onmousemove = function (evt)
			{
				if(evt.which==0)
				{
					Mouse_Down_Flag=0;
				}
				refresh_evt(evt);
			}

			chart.ontouchstart = function (evt) 
			{
				x = (evt.pageX-chart.offsetLeft)*ratio;
				y = (evt.pageY-chart.offsetTop)*ratio;
				org_x = x;
				org_y = y;
				org_L = L_limit;
				org_R = R_limit;
				org_max_T = max_T;
				org_min_T = min_T;
				org_max_H = max_H;
				org_min_H = min_H;

				Mouse_Down_Flag=get_area_id(org_x,org_y);		

				refresh();
			}

			chart.ontouchend = function (evt)
			{
				x = (evt.pageX-chart.offsetLeft)*ratio;
				y = (evt.pageY-chart.offsetTop)*ratio;
				Mouse_Down_Flag=0;
				refresh();
			}

			chart.ontouchmove= function (evt)
			{
				evt.preventDefault();	
				x = (evt.pageX-chart.offsetLeft)*ratio;
				y = (evt.pageY-chart.offsetTop)*ratio;
    			if(
    				get_area_id(x,y)==2
    				|| get_area_id(x,y)==3
    				|| Mouse_Down_Flag==2
    				|| Mouse_Down_Flag==3
    				) 
				{
					window.event.returnValue = false;
    			}
    			else
    			{
    				window.event.returnValue = true;
    			}
    			refresh (evt);
			}

			function refresh_evt(evt)
			{
				x = (evt.pageX-chart.offsetLeft)*ratio;
				y = (evt.pageY-chart.offsetTop)*ratio;
				refresh();
			}

			function graph_grid_gen(ctx)
			{
				//Graph Grid Drawing
				//------------------------
				ctx.strokeStyle="#666666";
				ctx.lineWidth = 0.4 * ratio * Scale_Index;
				ctx.beginPath();

				//Horizontal Grid
				for (var i=0; i<=H_Lines; i++)
				{ 
					ctx.moveTo(0,i*Grid_length);
					ctx.lineTo(WIDTH,i*Grid_length);
				}

				//Vertial Grid
				for (var i=0; i<=V_Lines; i++)
				{ 
					ctx.moveTo(i*Grid_length,0);
					ctx.lineTo(i*Grid_length,HEIGHT_Chart);
				}

				ctx.stroke();
			}

			function graph_content_gen(ctx)
			{
				//Graph Content Drawing
				//---------------------
				//DRAW TEMPERATURE CHART:
				ctx.strokeStyle=TEMP_Color;
				ctx.lineWidth = golbal_line_width;
				ctx.beginPath();
				ctx.moveTo(WIDTH,HEIGHT_Chart*(1-(TEMP_Buf[R_limit]-min_T)/(max_T-min_T)));
				for (var i=R_limit;i<=L_limit;i++)
				{ 
					var val=TEMP_Buf[i];
					if (val>max_T) val=max_T;
					if (val<min_T) val=min_T;
					ctx.lineTo(WIDTH-(i-R_limit)*(WIDTH/(L_limit-R_limit)),HEIGHT_Chart*(1-(val-min_T)/(max_T-min_T)));
				}
				ctx.stroke();

				//DRAW HUMIDITY CHART:
				ctx.strokeStyle=HUMIDITY_Color;
				ctx.lineWidth = golbal_line_width;
				ctx.beginPath();
				ctx.moveTo(WIDTH,HEIGHT_Chart*(1-(HUMIDITY_Buf[R_limit]-min_H)/(max_H-min_H)));
				for (var i=R_limit;i<=L_limit;i++)
				{ 
					var val=HUMIDITY_Buf[i];
					if (val>max_H) val=max_H;
					if (val<min_H) val=min_H;
					ctx.lineTo(WIDTH-(i-R_limit)*(WIDTH/(L_limit-R_limit)),HEIGHT_Chart*(1-(val-min_H)/(max_H-min_H)));
				}
				ctx.stroke();
			}

			function assistline_gen(position_x)
			{
				ctx.save();
				var data_tag=Math.floor(L_limit-position_x/(WIDTH/(L_limit-R_limit))+0.5)

				//Vertical assistline
				if(Mouse_Down_Flag==1)
				{
					ctx.strokeStyle="#00CACA";
					ctx.lineWidth = 1.5;
					if(ratio==2) ctx.lineWidth = 3;
				}
				else if(Mouse_Down_Flag==0)
				{
					ctx.strokeStyle="#00CACA";
					ctx.setLineDash([10,8]);
					ctx.lineWidth = 1;
					if(ratio==2) ctx.lineWidth = 2;
				}
				ctx.beginPath();
				ctx.moveTo(position_x,0);
				ctx.lineTo(position_x,HEIGHT_Chart);
				ctx.stroke();
				ctx.restore();
				
				//Horizational Temperature assistline
				ctx.strokeStyle=TEMP_Color;
				ctx.setLineDash([5,5]);
				ctx.lineWidth = 0.5;
				if(ratio==2) ctx.lineWidth = 1;
				var TEMP_Data_axis_Y=HEIGHT_Chart*(1-(TEMP_Buf[data_tag]-min_T)/(max_T-min_T));

				ctx.beginPath();
				ctx.moveTo(0,TEMP_Data_axis_Y);
				ctx.lineTo(WIDTH,TEMP_Data_axis_Y);
				ctx.stroke();
				ctx.restore();

				//Horizational Humidity assistline
				ctx.strokeStyle=HUMIDITY_Color;
				ctx.setLineDash([5,5]);
				ctx.lineWidth = 0.5;
				if(ratio==2) ctx.lineWidth = 1;
				var HUMIDITY_Data_axis_Y=HEIGHT_Chart*(1-(HUMIDITY_Buf[data_tag]-min_H)/(max_H-min_H));

				ctx.beginPath();
				ctx.moveTo(0,HUMIDITY_Data_axis_Y);
				ctx.lineTo(WIDTH,HUMIDITY_Data_axis_Y);
				ctx.stroke();
				ctx.restore();

				//Data Tag Drawing
				//Temperature
				ctx.textAlign="left";
				ctx.textBaseline="top";
				ctx.fillStyle=TEMP_Color;
				ctx.font="bold italic "+font_size_uni_str(12)+" Arial";

				var axis_x=position_x;
				var axis_y=TEMP_Data_axis_Y;
				var horizational_space=4;
				var vertical_space=4;

				if ((WIDTH-axis_x)<(Grid_length*1.5))
				{
					ctx.textAlign="right";
					horizational_space=-4;
				}

				if ((HEIGHT_Chart-axis_y)<Grid_length)
				{
					ctx.textBaseline="bottom";
					vertical_space=-4;
				}

				ctx.fillText(TEMP_Buf[data_tag].toString(),axis_x+horizational_space*ratio,axis_y+vertical_space*ratio);
				ctx.restore();

				//Humidity
				ctx.textAlign="left";
				ctx.textBaseline="top";
				ctx.strokeStyle = "#FFFFFF";
				ctx.fillStyle=HUMIDITY_Color;
				ctx.font="bold italic "+font_size_uni_str(12)+" Arial";

				var axis_x=position_x;
				var axis_y=HUMIDITY_Data_axis_Y;
				var horizational_space=4;
				var vertical_space=4;

				if ((WIDTH-axis_x)<(Grid_length*1.5))
				{
					ctx.textAlign="right";
					horizational_space=-4;
				}

				if ((HEIGHT_Chart-axis_y)<Grid_length)
				{
					ctx.textBaseline="bottom";
					vertical_space=-4;
				}

				ctx.fillText(HUMIDITY_Buf[data_tag].toString(), axis_x+horizational_space*ratio, axis_y+vertical_space*ratio);
				ctx.restore();

				//Humidity
				ctx.textAlign="left";
				ctx.strokeStyle = "#00CACA";
				ctx.fillStyle="#AAAAAA";
				ctx.font=font_size_uni_str(10)+" Arial";

				var ts_dt=DATETIME_Buf[data_tag].split(" ")[0];
				var ts_ms=DATETIME_Buf[data_tag].split(" ")[1];
				var axis_x=position_x;
				var axis_y=Math.ceil(HEIGHT_Chart-Grid_length/3);
				var horizational_space=4;
				var vertical_space=4;

				if ((WIDTH-axis_x)<(Grid_length*1.5))
				{
					ctx.textAlign="right";
					horizational_space=-4;
				}

				ctx.textBaseline="bottom";
				ctx.fillText(ts_dt, axis_x+horizational_space*ratio, axis_y+vertical_space*ratio);
				ctx.textBaseline="top";
				ctx.fillText(ts_ms, axis_x+horizational_space*ratio, axis_y+vertical_space*ratio);
				ctx.restore();
				ctx.setLineDash([]);
			}

			function graph_highlight(ctx)
			{
				if(Mouse_Down_Flag==0)
				{
					if(Mouse_Position_Flag==2)
					{
						ctx.fillStyle=TEMP_BKG_Color;
						ctx.fillRect(0,0,marker_WIDTH,HEIGHT_Chart);
					}
					}
					if(Mouse_Position_Flag==3)
					{
						ctx.fillStyle=HUMIDITY_BKG_Color;
						ctx.fillRect(WIDTH-marker_WIDTH,0,WIDTH,HEIGHT_Chart);
				}
				if(Mouse_Down_Flag==2)
				{
					if(Mouse_Position_Flag==2)
					{
						ctx.fillStyle=TEMP_OnGrag_Color;
						ctx.fillRect(0,0,marker_WIDTH,HEIGHT_Chart);
					}
					if(Mouse_Position_Flag==1)
					{
						ctx.fillStyle=On_Outside_Drag_Clolr;
						ctx.fillRect(0,0,marker_WIDTH,HEIGHT_Chart);
					}
				}
				if(Mouse_Down_Flag==3)
				{
					if(Mouse_Position_Flag==3)
					{
						ctx.fillStyle=HUMIDITY_OnGrag_Color;
						ctx.fillRect(WIDTH-marker_WIDTH,0,WIDTH,HEIGHT_Chart);
					}
					if(Mouse_Position_Flag==1)
					{
						ctx.fillStyle=On_Outside_Drag_Clolr;
						ctx.fillRect(WIDTH-marker_WIDTH,0,WIDTH,HEIGHT_Chart);
					}
				}
			}

			function graph_marker_gen(ctx)
			{
				//Changing Variables
				var Padding_space=0;
				//Left Marker -- TENPERATURE
				ctx.textAlign="left";
				ctx.fillStyle=TEMP_Color;
				ctx.font="Bold "+font_size_uni_str(12)+" Arial";
				var max_Marker=max_T;
				var min_Marker=min_T;
				for (var i=0; i<=H_Lines; i++)
				{
					ctx.textBaseline="middle";
					if(i==0) ctx.textBaseline="top";
					if(i==H_Lines) ctx.textBaseline="bottom";
					var MARK=min_Marker+((H_Lines-i)/(H_Lines))*(max_Marker-min_Marker);
					ctx.fillText(format_F(MARK,2),0+side_spacing*ratio,i*Grid_length);
				}

				//Left Mark lines
				ctx.strokeStyle=TEMP_Color;
				ctx.beginPath();
				ctx.lineWidth=Mark_line_wid;
				ctx.moveTo(Mark_line_wid/2,0);
				ctx.lineTo(Mark_line_wid/2,HEIGHT_Chart);
				ctx.stroke();
				for (var i=0; i<=H_Lines; i++)
				{
					ctx.beginPath();
					Padding_space=0;
					if(i==0) Padding_space=Mark_line_wid/2;
					if(i==H_Lines) Padding_space=-Mark_line_wid/2;
					ctx.lineWidth=Mark_line_wid;
					ctx.moveTo(0+Mark_line_wid,i*Grid_length+Padding_space);
					ctx.lineTo(Mark_line_len+Mark_line_wid,i*Grid_length+Padding_space);
					ctx.stroke();
					if(i<H_Lines)
					{
						for(var j=1;j<5;j++)
						{
							ctx.lineWidth=Math.floor(Mark_line_wid/2);
							ctx.beginPath();
							ctx.moveTo(0+Mark_line_wid,i*Grid_length+j*Grid_length/5);
							ctx.lineTo(Mark_line_len/1.5+Mark_line_wid,i*Grid_length+j*Grid_length/5);
							ctx.stroke();
						}
					}
				}
				ctx.stroke();


				//Right Marker -- HUMIDITY
				ctx.textAlign="right";
				ctx.fillStyle=HUMIDITY_Color;
				ctx.font="Bold "+font_size_uni_str(12)+" Arial";
				var max_Marker=max_H;
				var min_Marker=min_H;
				for (var i=0; i<=H_Lines; i++)
				{
					ctx.textBaseline="middle";
					if(i==0) ctx.textBaseline="top";
					if(i==H_Lines) ctx.textBaseline="bottom";
					var MARK=min_Marker+((H_Lines-i)/(H_Lines))*(max_Marker-min_Marker);
					ctx.fillText(format_F(MARK,2),WIDTH-side_spacing*ratio,i*Grid_length);
				}
				//Right Mark lines
				ctx.strokeStyle=HUMIDITY_Color;
				ctx.beginPath();
				ctx.lineWidth=Mark_line_wid;
				ctx.moveTo(WIDTH-Mark_line_wid/2,0);
				ctx.lineTo(WIDTH-Mark_line_wid/2,HEIGHT_Chart);
				ctx.stroke();
				for (var i=0; i<=H_Lines; i++)
				{
					ctx.beginPath();
					Padding_space=0;
					if(i==0) Padding_space=Mark_line_wid/2;
					if(i==H_Lines) Padding_space=-Mark_line_wid/2;
					ctx.lineWidth=Mark_line_wid;
					ctx.moveTo(WIDTH-Mark_line_wid,i*Grid_length+Padding_space);
					ctx.lineTo(WIDTH-Mark_line_len-Mark_line_wid,i*Grid_length+Padding_space);
					ctx.stroke();
					if(i<H_Lines)
					{
						for(var j=1;j<5;j++)
						{
							ctx.lineWidth=Math.floor(Mark_line_wid/2);
							ctx.beginPath();
							ctx.moveTo(WIDTH-Mark_line_wid,i*Grid_length+j*Grid_length/5);
							ctx.lineTo(WIDTH-Mark_line_len/1.5-Mark_line_wid,i*Grid_length+j*Grid_length/5);
							ctx.stroke();
						}
					}
				}
				ctx.stroke();

				//Buttom Marker -- Date Time
				ctx.fillStyle="#666666";
				ctx.font="Bold "+font_size_uni_str(12)+" Arial";
				var max_Marker=L_limit;
				var min_Marker=R_limit;
				var Marker_Count=5;
				var height_axis=0;
				for (var i=0; i<=Marker_Count; i++)
				{
					height_axis=Math.floor(HEIGHT_Chart+HEIGHT_Container/10);
					ctx.textAlign="center";
					if(i==0) ctx.textAlign="left";
					if(i==Marker_Count) ctx.textAlign="right";
					ctx.textBaseline="top";
					var MARK=min_Marker+(1-i/(Marker_Count))*(max_Marker-min_Marker);
					if(Math.floor(MARK)<=0)
					{
						ctx.font="Bold "+font_size_uni_str(12)+" Arial";
						ctx.fillText("NOW",i*WIDTH/Marker_Count,height_axis);
						height_axis+=(HEIGHT_Container/10+font_size_uni(12));
						ctx.font="Bold "+font_size_uni_str(8)+" Arial";
						ctx.fillText("Real Time",i*WIDTH/Marker_Count,height_axis);
					}
					else
					{
						ctx.font="Bold "+font_size_uni_str(12)+" Arial";
						ctx.fillText(Math.ceil(MARK-0.00000001).toString(),i*WIDTH/Marker_Count,height_axis);
						height_axis+=(HEIGHT_Container/10+font_size_uni(12));
						ctx.font="Bold "+font_size_uni_str(8)+" Arial";
						ctx.fillText("Hours Ago",i*WIDTH/Marker_Count,height_axis);
					}
				}
				ctx.restore();
			}

			function graph_mouse_track(ctx)
			{
				if(
					(( Mouse_Position_Flag==1 || Mouse_Position_Flag==5) 
					&& ( Mouse_Down_Flag==0 || Mouse_Down_Flag==1 || Mouse_Down_Flag==5 )
					|| (Mouse_Down_Flag==0 && (Mouse_Position_Flag==2 || Mouse_Position_Flag==3)))
				   )
				{
					assistline_gen(x);
				}
				if (Debug)
				{
					var Pedding=commom_DBG();
					var MARK="X"+x.toString()+" Y"+y.toString();
					ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
					Pedding+=Pedding_len;
				}
			}

			function graph_clear()
			{
				chart.width=WIDTH.toString();
				chart.height=HEIGHT.toString();
			}

			function graph_gen()
			{
				chart=document.getElementById("TH_Chart");
				ctx=chart.getContext("2d");
				ctx.save();

				graph_highlight(ctx);
				ctx.restore();

				graph_grid_gen(ctx);
				ctx.restore();

				graph_content_gen(ctx);
				ctx.restore();

				graph_mouse_track(ctx);
				ctx.restore();

				graph_marker_gen(ctx);
				ctx.restore();

				if(Debug) commom_DBG();

				return ctx;
			}

			function refresh()
			{
				if(Mouse_Position_Flag!=get_area_id(x,y))
				{
					org_x = x;
					org_y = y;
					org_L = L_limit;
					org_R = R_limit;
					org_max_T = max_T;
					org_min_T = min_T;
					org_max_H = max_H;
					org_min_H = min_H;
				}
				Mouse_Position_Flag=get_area_id(x,y)

				//Main Graph Area Drag (Move,Horizational)
				if(Mouse_Down_Flag==1 && Mouse_Position_Flag==1)
				{
					var distence=(org_x-x)*(org_R-org_L)/WIDTH;
					var New_L=Math.floor(org_L+distence);
					var New_R=Math.floor(org_R+distence);
					if(New_L>L_limit_max)
					{
						New_R-=(New_L-L_limit_max);
						New_L=L_limit_max;
					}
					if(New_R<R_limit_min)
					{
						New_L+=(R_limit_min-New_R);
						New_R=R_limit_min;
					}		
					if(New_L>L_limit_max) New_L=L_limit_max;
					L_limit=New_L;
					R_limit=New_R;
				}

				//Left Marker Area Drag (Move,Vertiacl)
				if(Mouse_Down_Flag==2 && Mouse_Position_Flag==2)
				{
					var distence=((org_max_T-org_min_T)*(y-org_y)/HEIGHT_Chart);
					var New_Max=org_max_T+distence;
					var New_Min=org_min_T+distence;
					max_T=New_Max;
					min_T=New_Min;
				}

				//Left Marker Area Drag (Scale,Vertiacl)
				if(Mouse_Down_Flag==2 && Mouse_Position_Flag==1)
				{
					var distence=((org_max_T-org_min_T)*(y-org_y)/HEIGHT_Chart);
					var New_Max=org_max_T+distence;
					var New_Min=org_min_T-distence;
					if (New_Max<New_Min)
					{
						var temp=New_Max;
						New_Max=New_Min;
						New_Min=temp;
					}
					max_T=New_Max;
					min_T=New_Min;
				}

				//Right Marker Area Drag (Move,Vertiacl)
				//_____________________________________
				if(Mouse_Down_Flag==3 && Mouse_Position_Flag==3)
				{
					var distence=((org_max_H-org_min_H)*(y-org_y)/HEIGHT_Chart);
					var New_Max=org_max_H+distence;
					var New_Min=org_min_H+distence;
					max_H=New_Max;
					min_H=New_Min;
				}

				//Right Marker Area Drag (Scale,Vertiacl)
				//_____________________________________
				if(Mouse_Down_Flag==3 && Mouse_Position_Flag==1)
				{
					var distence=((org_max_H-org_min_H)*(y-org_y)/HEIGHT_Chart);
					var New_Max=org_max_H+distence;
					var New_Min=org_min_H-distence;
					if (New_Max<New_Min)
					{
						var temp=New_Max;
						New_Max=New_Min;
						New_Min=temp;
					}
					max_H=New_Max;
					min_H=New_Min;				}

				//Bottom Marker Area Drag (Scale,Horizational)
				//_____________________________________
				if(Mouse_Down_Flag==4 && (Mouse_Position_Flag==4 ||Mouse_Position_Flag==5 ||Mouse_Position_Flag==1))
				{
					var distence=Math.ceil((x-org_x)*ratio/(WIDTH/(L_limit-R_limit)));
					var New_L=org_L+distence;
					var New_R=org_R-distence;
					if (New_L>L_limit_max) New_L=L_limit_max;
					if (New_R<R_limit_min) New_R=R_limit_min;
					if (New_L<New_R)
					{
						var temp=New_L;
						New_L=New_R;
						New_R=temp;
					}
					L_limit=New_L;
					R_limit=New_R;
				}
				if (L_limit>L_limit_max) L_limit=L_limit_max;
				if (R_limit<R_limit_min) R_limit=R_limit_min;
				graph_clear();
				graph_gen();
			}

			RESET_ALL();
			graph_gen();
		//<!--######################################################################################-->
			function font_size_uni_str(size_def)
			{
				return font_size_uni(size_def).toString()+"px";
			}

			function font_size_uni(size_def)
			{
				return Math.ceil(size_def*ratio*Scale_Index);
			}

			function get_area_id(ax,ay)
			{
				if ( ay>=(HEIGHT_Chart-4) && ay<=(HEIGHT_Chart+HEIGHT_Container) )
		   		{
		   			if(ay>(HEIGHT_Chart+5))return 4;
		   			else return 5;
		   		}
				else if(ay<=HEIGHT_Chart && ay>Grid_length/6 && ax>0 && ax<WIDTH)
				{
					if(ax<=marker_WIDTH) return 2;
					else if(ax<=WIDTH-marker_WIDTH) return 1;
					else return 3;
				}
				return 0;

			}

			function format_F(x,n)
			{
				var minus_flag=x>0?false:true;
				x=x>0?x:-x;
				int_x=Math.floor(x);
				x-=int_x;
				for (var i=0;i<n;i++) x*=10;
				flo_x=Math.floor(x);
				if (n<=0) return int_x.toString();
				return int_x.toString()+"."+flo_x.toString();
			}

			function commom_DBG()
			{

				var Pedding=0;
				ctx.fillStyle="#000";
				ctx.font=font_size_uni_str(12)+" Arial thin";
				ctx.textAlign="center";
				ctx.textBaseline="top";

				var MARK="▶ In Debug Mode ◀";
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="ratio "+ratio.toString()+" Device "+Device.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="offsetLeft "+chart.offsetLeft.toString()+" offsetTop "+chart.offsetTop.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="  L_limit_max "+L_limit_max.toString()+
						 "  R_limit_min "+R_limit_min.toString()+
						 "  Pedding_len "+Pedding_len.toString()+
						 "  marker_WIDTH "+marker_WIDTH.toString()+
						 "  chart_ratio "+chart_ratio.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="  max_T "+max_T.toString()+
						 "  min_T "+min_T.toString()+
						 "  max_H "+max_H.toString()+
						 "  min_H "+min_H.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;


				var MARK="  L_limit "+L_limit.toString()+
						 "  R_limit "+R_limit.toString()+
						 "  H_Lines "+H_Lines.toString()+
						 "  V_Lines "+V_Lines.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="Mouse Down "+Mouse_Down_Flag.toString()+"  Mouse Pos "+Mouse_Position_Flag.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="Html_Width "+document.getElementById("TH_Table").offsetWidth+"  Html_Height "+document.getElementById("TH_Table").offsetHight;
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				var MARK="Width "+WIDTH.toString()+"  Height "+HEIGHT_Chart.toString();
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				return Pedding;
			}

			function DBG_addStr(str,Pedding)
			{
				var MARK=str;
				ctx.fillText(MARK,WIDTH/2,Grid_length+Pedding);
				Pedding+=Pedding_len;

				return Pedding;
			}

			function L_limit_ADD(length)
			{
				L_limit+=length;
				refresh();
			}
			
			function R_limit_ADD(length)
			{
				R_limit+=length;
				refresh();
			}

			function  MOVE_LEFT(length)
			{
				var val_R=R_limit;
				var val_L=L_limit;
				if((val_L+length)>L_limit_max)
				{
					val_R+=(L_limit_max-val_L);
					val_L=L_limit_max;
					L_limit=val_L;
					R_limit=val_R;
					refresh();
				}
				else
				{
					L_limit_ADD(length);
					R_limit_ADD(length);
					refresh();
				}
			}

			function  MOVE_RIGHT(length)
			{
				var val_R=R_limit;
				var val_L=L_limit;
				if((val_R-length)<R_limit_min)
				{
					val_L-=(val_R-R_limit_min);
					val_R=R_limit_min;
					L_limit=val_L;
					R_limit=val_R;
					refresh();
				}
				else
				{
					L_limit_txt_WDR(length);
					R_limit_txt_WDR(length);
					refresh();
				}
			}

			function RESET_ALL()
			{		
				RESET();	
				max_T=Default_max_T[Device];
				min_T=Default_min_T[Device];
				max_H=Default_max_H[Device];
				min_H=Default_min_H[Device];
				L_limit=Default_L_limit[Device];
				R_limit=Default_R_limit[Device];
				RESET();
			}
			function RESET()
			{
				Device=0;

				if ( 
				navigator.userAgent.indexOf("iPhone")>0 
				|| navigator.userAgent.indexOf("UCWEB")>0 
				|| navigator.userAgent.indexOf("Android")>0 
				|| navigator.userAgent.indexOf("android")>0
				)Device=1;

				if ( 
				navigator.userAgent.indexOf("iPad")>0 
				)Device=3;

				if (navigator.userAgent.indexOf("iPhone")>0) 
					{
						try
						{
							if (window.orientation==90 || window.orientation==-90)
							{
								Device=2;
							}
						}
						catch(err)
						{
							;
						}
					}

				Scale_Index=Default_Scale_Index[Device];
				L_limit_max=Default_L_limit_max[Device];
				R_limit_min=Default_R_limit_min[Device];
				Pedding_len=Default_Pedding_len[Device];
				marker_WIDTH=Default_marker_WIDTH[Device]*Scale_Index;
				H_Lines=Default_H_Lines[Device];
				V_Lines=Default_V_Lines[Device];
				Mark_line_len=Default_Mark_line_len[Device]*Scale_Index;
				Mark_line_wid=Default_Mark_line_wid[Device]*Scale_Index;
				side_spacing =Default_side_spacing [Device]*Scale_Index;
				golbal_line_width = Default_golbal_line_width[Device]*Scale_Index;

				while ((typeof TEMP_Buf[vaild_n])=="number" && (typeof HUMIDITY_Buf[vaild_n])=="number")
				{
					vaild_n++;
				}
				L_limit_max=vaild_n;

				chart_ratio=(H_Lines+0.5*Scale_Index)/V_Lines;

				WIDTH=parseInt(document.getElementById("TH_Table").offsetWidth)*ratio;
				HEIGHT=Math.floor(WIDTH*chart_ratio);

				HEIGHT_Chart=Math.floor(HEIGHT*H_Lines/(H_Lines+0.5*Scale_Index));
				HEIGHT_Container=HEIGHT-HEIGHT_Chart;
				if (HEIGHT_Container<(65*Scale_Index) || true)
				{
					HEIGHT_Container=65*Scale_Index;
					HEIGHT=HEIGHT_Chart+HEIGHT_Container;
				}
				Grid_length=HEIGHT_Chart/H_Lines;

				chart.style.height=(Math.floor(HEIGHT/ratio)).toString()+"px";
				chart.width=WIDTH.toString();
				chart.height=HEIGHT.toString();

				//Debug=false;

				//document.getElementById("L_limit_txt").value=L_limit.toString();
				//document.getElementById("R_limit_txt").value=R_limit.toString();
				//document.getElementById("Max_Temp_txt").value=max_T.toString();
				//document.getElementById("Min_Temp_txt").value=min_T.toString();
				//document.getElementById("Max_Humidity_txt").value=max_H.toString();
				//document.getElementById("Min_Humidity_txt").value=min_H.toString();
				
				graph_gen();
			}

			function DBG_Switch()
			{
				Debug=!Debug;
				refresh();
			}
		</script>
	</body>
</html>